import: 
  - recipe/laravel.php
  - contrib/php-fpm.php
  - contrib/npm.php

config:
  application: 'orga'
  repository: 'https://github.com/WoodyNaDobhar/orga.git'
  php_fpm_version: '8.0'

hosts:
  dev:
    remote_user: orkorg
    deploy_path: '~/www/dev.ork4.org'
    hostname: 'chi201.greengeeks.net'
    stage: 'development'
    branch: 'development'
    writable_mode: 'chmod'
    http_user: 'www-data'

tasks:
  deploy:
    - deploy:prepare
    - deploy:vendors
    - artisan:down
    - artisan:storage:link
    - artisan:view:cache
    - artisan:config:cache
    - artisan:migrate
    - npm:install
    - build
    - deploy:publish
    - artisan:up
    - php-fpm:reload
  build:
    - run: 'cd {{release_path}} && npm run prod'
  generate-swagger: 
    - run: '{{bin/php}} {{release_path}}/artisan l5-swagger:generate'
  sync-scout: 
    - run: '{{bin/php}} {{release_path}}/artisan scout:sync-index-settings'

after:
  deploy:
    - generate-swagger
    - sync-scout
  deploy:failed: deploy:unlock
